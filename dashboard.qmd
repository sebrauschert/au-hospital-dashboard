---
title: "Australian Hospital Stats"
format:
  dashboard:
    logo: "images/logo.png"
    orientation: columns
---

## Row {width="45%"}

```{r, loadpackages}
#| echo: false
#| include: false
library(tidyverse)
library(httr)
library(jsonlite)
library(leaflet)
library(htmlwidgets)
library(gt)

# Get longitude and latitude

url <- "https://myhospitalsapi.aihw.gov.au//api/v1/reporting-units"

# Make the GET request
response <- GET(url)

# Check if the request was successful
if (status_code(response) == 200) {
  # Parse the response content
  datasets <- content(response, as = "text", encoding = "UTF-8")
  datasets <- fromJSON(datasets, flatten = TRUE)
  
  # Display the list of datasets
  print(datasets$result)
} else {
  # Print the error message
  print(paste("Failed to fetch datasets:", status_code(response)))
}


hospitals <- datasets$result |>
  select(longitude, latitude, reporting_unit_name)

```

```{r, showdata}
hospitals |> 
  gt(id = "custom") |>
  cols_label(
    longitude = md("**Longitude**"),
    latitude = md("**Latitude**"),
    reporting_unit_name = md("**Provider Name**")
  ) |> 
  tab_options(
    table.font.color = "#FFFFFF",
    table.background.color = "#191414",
    table.font.size = px(14),
    table.border.top.color = "transparent",
    table.border.bottom.color = "transparent",
    table_body.hlines.color = "transparent",
    table_body.border.bottom.color = "transparent",
    column_labels.border.bottom.color = "transparent",
    column_labels.border.top.color = "transparent",
    footnotes.background.color = "#282828",
    source_notes.background.color = "#282828"
  ) |> 
  # opt_interactive(
  #   active = TRUE,
  #   use_pagination = TRUE,
  #   use_pagination_info = TRUE,
  #   use_sorting = TRUE,
  #   use_search = FALSE,
  #   use_filters = FALSE,
  #   use_resizers = FALSE,
  #   use_highlight = FALSE,
  #   use_compact_mode = FALSE,
  #   use_text_wrapping = TRUE,
  #   use_page_size_select = FALSE,
  #   page_size_default = 50,
  #   page_size_values = c(10, 25, 50, 100),
  #   pagination_type = c("numbers", "jump", "simple"),
  #   height = "auto"
  # ) |>
  tab_style_body(
    style = cell_borders(
      sides = c("top", "bottom"),
      weight = px(0) # Remove row borders
    ),
    fn = function(x) { is.numeric(x) | is.character(x) }
  ) |> 
  opt_css(
    css = "
    table tr:nth-child(odd) {
      background-color: #282828;
    }
      
    table tr:hover {
      background-color: #383838;
    }
    
    div#custom {
      overflow-x: unset !important;
      overflow-y: unset !important;
    }
    
    #custom .gt_col_heading {
       position: sticky !important;
       top: -5px !important;
       z-index: 10 !important;
    }
    "
  ) |>
  cols_align(
  align = "left",
  columns = everything()
  ) 

```

## Column {width="55%"}


### Row {height="80%"}

```{r}
#| include: false
#| echo: false
# Create leaflet map
# Create the Leaflet map
map <- leaflet(hospitals) %>%
  addTiles() %>%
  addMarkers(~longitude, ~latitude, popup = ~reporting_unit_name,
             clusterOptions = markerClusterOptions()) %>%
  setView(lng = 133.7751, lat = -25.2744, zoom = 4) %>%  # Centered on Australia
  addEasyButton(easyButton(
    icon = "fa-globe",  # Font Awesome globe icon
    title = "Re-center",
    onClick = JS("function(btn, map) { map.setView([ -25.2744, 133.7751 ], 4); }")  # Set to the original view
  ))
# Save the map to an HTML file
saveWidget(map, "hospitals_map.html", selfcontained = TRUE)

```

<!-- Iframe for displaying the Leaflet map -->
<style>
.leaflet-layer,
.leaflet-control-zoom-in,
.leaflet-control-zoom-out,
.leaflet-control-attribution {
  filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
}
</style>

<iframe id="map-iframe" src="hospitals_map.html" width="100%" height="100%"></iframe>

<!-- Button to pop out the iframe -->
<button onclick="popOutIframe()">Pop Out Map</button>

<script>
function popOutIframe() {
  var iframeSrc = document.getElementById('map-iframe').src;
  window.open(iframeSrc, 'Map', 'width=800,height=600');
}
</script>



### Row {height="20%"}

Placeholder text row 3
